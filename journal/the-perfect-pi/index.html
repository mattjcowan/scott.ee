<!DOCTYPE html><html data-n-head="lang" data-n-head-ssr lang="en-gb"><meta data-n-head="true" charset="utf-8"><meta data-n-head="true" content="width=device-width,initial-scale=1" name="viewport"><meta data-n-head="true" content="summary_large_image" property="twitter:card"><meta data-n-head="true" content="@scottsweb" property="twitter:site"><meta data-n-head="true" content="@scottsweb" property="twitter:creator"><meta data-n-head="true" content="yes" data-hid="mobile-web-app-capable" name="mobile-web-app-capable"><meta data-n-head="true" content="Scott Evans" data-hid="apple-mobile-web-app-title" name="apple-mobile-web-app-title"><meta data-n-head="true" content="Scott Evans" data-hid="author" name="author"><meta data-n-head="true" content="#444444" data-hid="theme-color" name="theme-color"><meta data-n-head="true" content="website" data-hid="og:type" name="og:type" property="og:type"><meta data-n-head="true" content='In my next few posts I will be writing about my home automation setup which is based around a handful of Raspberry Pis. First though I want to document how I setup and get the most out of these fantastic little machines. Grab Raspbian Lite Head over to raspberrypi.org and download the latest copy of</p><p><a class="view-article" href="https://api.scott.ee/journal/the-perfect-pi/">Read more</a></p>' data-hid="description" name="description"><meta data-n-head="true" content="The Perfect Pi • Scott Evans" data-hid="og:title" property="og:title"><meta data-n-head="true" content='In my next few posts I will be writing about my home automation setup which is based around a handful of Raspberry Pis. First though I want to document how I setup and get the most out of these fantastic little machines. Grab Raspbian Lite Head over to raspberrypi.org and download the latest copy of</p><p><a class="view-article" href="https://api.scott.ee/journal/the-perfect-pi/">Read more</a></p>' data-hid="og:description" property="og:description"><meta data-n-head="true" content="https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?resize=700%2C391&ssl=1" data-hid="og:image" property="og:image"><title data-n-head="true">The Perfect Pi • Scott Evans</title><link href="//i0.wp.com" rel="dns-prefetch" data-n-head="true"><link href="//i1.wp.com" rel="dns-prefetch" data-n-head="true"><link href="//i2.wp.com" rel="dns-prefetch" data-n-head="true"><link href="/favicon.ico" rel="icon" data-n-head="true" type="image/x-icon"><link href="https://api.scott.ee/feed/" rel="alternate" data-n-head="true" type="application/rss+xml" title="RSS Feed | Scott Evans"><link href="/_nuxt/manifest.36c283f8.json" rel="manifest" data-n-head="true"><link href="/_nuxt/icons/icon_64.8wN8w0yx220.png" rel="shortcut icon" data-n-head="true"><link href="/_nuxt/icons/icon_512.8wN8w0yx220.png" rel="apple-touch-icon" data-n-head="true" sizes="512x512"><link href="/_nuxt/manifest.db55fc87d9178386dc97.js" rel="preload" as="script"><link href="/_nuxt/vendor.cceb4f39becbbe1be45e.js" rel="preload" as="script"><link href="/_nuxt/app.415c739b82f442bd5a40.js" rel="preload" as="script"><link href="/_nuxt/app.e9fe0fa1d78a8087870fcd49d9ef61ab.css" rel="preload" as="style"><link href="/_nuxt/layouts/default.5a3d1b942491c7b1e334.js" rel="preload" as="script"><link href="/_nuxt/pages/journal/_slug.cbe578972c01cc58c6be.js" rel="preload" as="script"><link href="/_nuxt/pages/_slug.e768ffab97d1242da658.js" rel="prefetch"><link href="/_nuxt/pages/index.2cddb0db2af1d7d04e3f.js" rel="prefetch"><link href="/_nuxt/pages/page/_id.8dacbd03ba94e994073f.js" rel="prefetch"><link href="/_nuxt/app.e9fe0fa1d78a8087870fcd49d9ef61ab.css" rel="stylesheet"><style data-vue-ssr-id="123d0840:0"></style><body class="post post-id-1604 single" data-n-head="class"><div id="__nuxt" data-server-rendered="true"><div class="nuxt-progress" style="width:0%;height:2px;background-color:#00bcd4;opacity:0"></div><div id="__layout"><div class="app"><header class="medium-container site-header" role="banner"><div class="site-header-container"><a href="/" class="nuxt-link-active"><div class="logo"><svg aria-labelledby="logoTitle logoDesc" height="93.84962" role="img" viewBox="0 0 319.68871 93.84962" width="319.68872" xmlns="http://www.w3.org/2000/svg"><title id="logoTitle">Go home</title><desc id="logoDesc">Text logo</desc><g clip-path="url(#a)" transform="matrix(.84248 0 0 -.84248 -204.89963 300.55796)"><path d="M301.9824 323.9043c5.626 6.317 12.713 9.536 21.251 9.673 4.019 8.172 9.999 15.199 17.324 20.482-5.419 1.72-11.005 2.593-16.761 2.593-5.102 0-10.205-.709-15.313-2.122-5.103-1.411-9.851-3.413-14.25-5.994-4.397-2.583-8.641-6.21-12.73-10.887-4.089-4.673-7.32-10.159-9.687-16.464-.483-1.289-.905-2.601-1.29-3.927h26.775c1.312 2.385 2.881 4.624 4.681 6.646m208.754 32.715c6.95-4.423 12.492-10.136 16.601-17.162 1.112-1.9 2.081-3.84 2.935-5.812h7.567v-16.387h26.474v16.387h21.026v-16.387h26.474v16.387h10.859v22.974zm-93.406-39.361h26.411c.121.228.232.46.359.687 2.836 5.061 6.738 8.994 11.71 11.802 4.97 2.804 9.865 4.208 14.683 4.208 4.881 0 9.714-1.416 14.503-4.255 4.788-2.834 8.584-6.859 11.391-12.076.066-.121.12-.245.183-.366h26.637c-1.19 4.101-2.823 8.071-4.957 11.893-4.818 8.631-11.587 15.386-20.31 20.266-8.721 4.878-17.9 7.319-27.536 7.319-9.577 0-18.757-2.457-27.54-7.363-8.783-4.912-15.629-11.745-20.538-20.494-2.127-3.791-3.791-7.665-4.996-11.621m74.71-38.927c-5.704-6.405-12.915-9.607-21.636-9.607-5.186 0-10.173 1.357-14.959 4.071-4.789 2.713-8.587 6.602-11.39 11.666-1.955 3.525-3.212 7.295-3.804 11.295h-25.539c-.936-6.536-3.652-12.347-8.172-17.425-5.704-6.405-12.915-9.607-21.636-9.607-5.186 0-10.173 1.357-14.959 4.071-4.789 2.713-8.587 6.602-11.39 11.666-1.955 3.524-3.21 7.294-3.8 11.295h-25.52c-1.198-6.551-4.211-12.731-8.59-17.651-5.75-6.457-13.022-9.685-21.815-9.685-5.227 0-10.256 1.367-15.082 4.102-4.829 2.736-8.659 6.658-11.485 11.763-1.984 3.578-3.256 7.406-3.848 11.471h-25.205c.623-6.41 2.332-12.543 5.159-18.39 2.768-5.781 6.611-11.148 11.533-16.098 4.918-4.949 10.792-8.84 17.617-11.669 6.827-2.827 13.932-4.242 21.311-4.242 5.103 0 10.206.709 15.313 2.122 5.103 1.411 9.852 3.413 14.251 5.994 4.397 2.583 8.641 6.21 12.73 10.887.441.505.869 1.023 1.291 1.548 1.211-1.457 2.498-2.885 3.881-4.275 4.877-4.91 10.702-8.768 17.472-11.573 6.77-2.804 13.818-4.208 21.136-4.208 5.06 0 10.121.703 15.187 2.105 5.061 1.4 9.771 3.384 14.134 5.946 4.36 2.562 8.569 6.158 12.625 10.796.355.405.695.825 1.036 1.243 1.22-1.469 2.517-2.908 3.91-4.309 4.877-4.91 10.702-8.768 17.472-11.573 6.77-2.804 13.818-4.208 21.136-4.208 5.06 0 10.121.703 15.187 2.105 5.061 1.4 9.771 3.384 14.134 5.946 4.36 2.562 8.569 6.158 12.625 10.796 4.055 4.635 7.259 10.076 9.607 16.329 1.751 4.663 2.847 9.573 3.294 14.728h-25.03c-.936-6.537-3.66-12.346-8.181-17.425m93.299-32.547h26.474v49.972h-26.474zm-47.5 0h26.474v49.972h-26.474zm-206.009 71.474h26.414c.121.228.23.46.356.687 2.836 5.061 6.738 8.994 11.71 11.802 4.97 2.804 9.769 3.882 14.586 3.882 4.462 0 9.774.051 14.855.06l.004-.007h11.027c.002.003.003.006.004.009h.016c.01.031.018.06.027.091.843 1.936 1.796 3.845 2.888 5.712 4.109 7.026 9.652 12.739 16.601 17.162l-44.797.098.017-.028c-.211.002-.422.01-.634.01-9.577 0-18.757-2.457-27.54-7.363-8.783-4.912-15.629-11.745-20.538-20.494-2.127-3.791-3.791-7.665-4.996-11.621m83.277-12.002h24.966c.327 2.973 1.024 5.804 2.069 8.502h-25.754c-.652-2.794-1.076-5.628-1.281-8.502m83.075 8.502c1.087-2.75 1.807-5.584 2.158-8.502h24.99c-.197 2.897-.618 5.728-1.231 8.502zm87.157-8.502h26.474v8.502h-26.474zm-255.732 0h24.973c.327 2.972 1.011 5.806 2.056 8.502h-25.748c-.652-2.794-1.076-5.628-1.281-8.502m208.232 0h26.474v8.502h-26.474zm-242.224 8.502h-25.991c-.607-2.756-1-5.593-1.2-8.502h24.787c.448 2.925 1.264 5.784 2.404 8.502"></path></g></svg></div><span class="screen-reader-text title">Scott Evans</span></a><nav class="navigation"><ul class="pagination pagination-single"><li><a href="/" class="nuxt-link-active"><span class="screen-reader-text">Back to home</span><svg aria-labelledby="backTitle" height="24" role="img" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink"><title id="backTitle">Menu icon</title><path d="M5,13L9,17L7.6,18.42L1.18,12L7.6,5.58L9,7L5,11H21V13H5M21,6V8H11V6H21M21,16V18H11V16H21Z"></path></svg></a></ul></nav></div></header><main class="content small-container" role="main"><article class="post hentry" id="post-id-1604"><header class="entry-header"><time class="entry-date published" datetime="post.date">July 15th, 2018</time><h1 class="entry-title">The Perfect Pi</h1></header><div class="entry-content"><div><p>In my next few posts I will be writing about my home automation setup which is based around a handful of Raspberry Pis. First though I want to document how I setup and get the most out of these fantastic little machines.<p><noscript><img alt="A Raspberry Pi Zero computer on a grey background" class="alignnone size-full wp-image-1635" data-recalc-dims="1" sizes="(max-width: 900px) 100vw, 900px" src="https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?w=900&ssl=1" srcset="https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?w=1500&ssl=1 1500w, https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?resize=250%2C140&ssl=1 250w, https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?resize=768%2C429&ssl=1 768w, https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?resize=700%2C391&ssl=1 700w, https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?resize=120%2C67&ssl=1 120w"></noscript><div class="lazy"><img alt="A Raspberry Pi Zero computer on a grey background" class="alignnone size-full wp-image-1635" data-recalc-dims="1" sizes="(max-width: 900px) 100vw, 900px" src="" srcset="" data-src="https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?w=900&ssl=1" data-srcset="https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?w=1500&ssl=1 1500w, https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?resize=250%2C140&ssl=1 250w, https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?resize=768%2C429&ssl=1 768w, https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?resize=700%2C391&ssl=1 700w, https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?resize=120%2C67&ssl=1 120w"></div><p><h3>Grab Raspbian Lite</h3><p>Head over to <a href="https://www.raspberrypi.org/downloads/raspbian/">raspberrypi.org</a> and download the latest copy of Raspbian Lite. Every single Pi I have ever setup has been a headless machine so you don’t need the bloat of the desktop environment. <a href="https://etcher.io/">Etcher</a> is a great tool for flashing the downloaded image to your SD card. Whilst you have the SD card in your computer, create a <a href="https://www.raspberrypi.org/documentation/remote-access/ssh/">blank file</a> called <code>ssh</code> in the <code>boot</code> directory to enable <code>ssh</code> and consider adding <a href="https://www.raspberrypi.org/documentation/configuration/wireless/headless.md">wireless network information</a> if your Pi will be using WiFi.<h3>Set a Fixed IP</h3><p>A fixed IP will make it easier to reliably <code>ssh</code> into the machine and browse to any services it may be running. I always set a static IP via my router. I find this a little quicker and simpler to do than on the Raspberry Pi itself and it makes the Pi more portable should I ever change my network, or take it elsewhere. Your router documentation should be able to guide you through the process.<h3>Login and Update</h3><pre>ssh pi@192.168.1.10</pre><p>Once you have set your static IP you can login via terminal with the <code>pi</code> username and the default password of <code>raspberry</code>. You can then update the default software stack using:<pre>sudo apt-get update
sudo apt-get upgrade</pre><h3>Raspi Config</h3><p>This little utility will do a number of things. It will expand the file system, giving you access to the entire SD card, set a memorable hostname and lower the GPU memory to minimum (16mb). With the Pi running headless you shouldn’t really need any graphics memory and this gives you the maximum amount of RAM for your projects and code. Run the utility with <code>raspi-config</code>, key around to change the above settings. Once that is done you will need to reboot and login again.<p>After rebooting it is worth checking your time and timezone with <code>dpkg-reconfigure tzdata</code>. It has a similar interface to <code>raspi-config</code> and should be easy to find your way around with the keyboard.<h3>Add a New User</h3><p>It is a good idea to create your own user account and trash the original pi user. This will keep your Pi nice and safe should you expose it to the Internet or invite a hacker to stay in your house. Run the following commands in sequence replacing <code>&lt;name></code> with your chosen username.<pre>sudo useradd -m &lt;name> -G sudo
sudo passwd &lt;name>
exit
ssh &lt;name>@192.168.1.10
sudo adduser &lt;name> video
sudo deluser -remove-home pi</pre><p>These steps will:<ul><li>Create you new user and add it to the <code>sudo</code> group<li>Setup your password for your new user<li>Logout<li>Log back in again (remember to change the IP to that of your Pi)<li>Add your new user to the video group which fixes a few Raspberry Pi tools like checking CPU temp<li>Delete the original pi user and all files in the home directory (make sure you have backed up what you need there first)</ul><p>If you find you are unable to autocomplete (tab) commands in your terminal with your new user it may be because you are using the wrong shell. You can fix this <a href="https://serverfault.com/a/99791">following the guide here</a>.<h3>Install Git</h3><pre>sudo apt-get install git-core</pre><p>I try to store most of my project code on <a href="https://github.com/scottsweb">GitHub</a> if possible and the git-core package will make it possible to push and pull code from the command line. Whilst you are messing around with Git I recommend taking a look at the <a href="https://github.com/azlux/log2ram%EF%BF%BD">log2ram project</a>. It will store all of your system logs in RAM which is useful for reducing SD card wear and prolonging the life of the card. I don’t use it on all my Pi projects but it can be useful on busy systems where you have some RAM to spare.<h3>Speed Tweaks</h3><p>As well as the usual <a href="https://www.raspberrypi.org/documentation/configuration/config-txt/overclocking.md">processor overclocking</a> that you <em>can</em> do (I haven’t felt the need yet), you can also improve the performance of the SD card. To do so edit <code>boot/config.txt</code> and add <code>dtoverlay=sdhost,overclock_50=100</code> on a new line in the file. The overclock value will need to be adjusted to suit the SD card you are using. It is a fairly <a href="https://www.jeffgeerling.com/blog/2016/how-overclock-microsd-card-reader-on-raspberry-pi-3">involved process</a> to get the best value for your card but can make a real difference. <code>dmesg</code> is also useful for spotting issues. You should note that this change can cause issues with WiFi too if you are relying on that for your network connection.<h3>Power Tweaks</h3><p>One of my favourite things about Raspberry Pis is how power efficient they are. It means you can leave them all the time without worrying about the environmental impact or huge energy bills. With a few additional tweaks you can save a few more milliamps. There are some great tips come from Jeff Geerling in these <a href="http://www.jeffgeerling.com/blogs/jeff-geerling/raspberry-pi-zero-conserve-energy%EF%BF%BD">excellent</a> <a href="http://www.jeffgeerling.com/blogs/jeff-geerling/controlling-pwr-act-leds-raspberry-pi%EF%BF%BD">posts</a> that are worth running through. My favourite tweak is disabling the HDMI circuitry by adding <code>/usr/bin/tvservice -o</code> to <code>/etc/rc.local</code>.<h3>Docker</h3><p><a href="https://www.docker.com/">Docker</a> is a containerisation software that allows you to isolate software applications. Containers are more lightweight than traditional virtual machines. I find Docker the best way to run services on the Raspberry Pi, it allows me to get the most out of the resources available and removes the need to for reformat the SD card every time my tinkering goes a bit too far. Install docker with the following command and then add your user to the docker group:<pre>curl -sSL https://get.docker.com | sh
sudo usermod -aG docker &lt;name>
</pre><p>Once again replace <code>&lt;name></code> with your chosen username. I recommend installing docker compose too. This will allow you to configure and start you containers reliably from <code class="highlighter-rouge">docker-compose.yml</code> config files.<pre>sudo apt-get install python-pip
sudo pip install docker-compose
</pre><p>This last Docker trick is optional. Docker can use quite a bit of space on your SD card so if you have external storage (like a hard drive) it can sometimes be beneficial to move <a href="http://stackoverflow.com/questions/24309526/how-to-change-the-docker-image-installation-directory">dockers internals to a different storage location</a>. Edit the docker.service file (<code>sudo nano /lib/systemd/system/docker.service</code>) and modify the line starting with <code>ExecStart</code> to be:<pre>ExecStart=/usr/bin/dockerd -H fd:// -g /path/to/external/storage/
</pre><p>The path should be to your external storage. You can then restart Docker and check the change has saved by running:<pre>sudo systemctl daemon-reload
sudo systemctl restart docker
docker info | grep "loop file\|Dir"
</pre><p>Updating Docker in future may require you to make this change again. You will know if it needs doing as your containers and images will disappear after an update.<h3>SSH</h3><p>Almost done. These next few steps will configure SSH, allow for a simpler login (SSH via public key) and mount an external server using <code>sshfs</code>. First generate some keys with <code>ssh-keygen -b 2048 -t rsa</code> and add public keys from your other computers to: <code>.ssh/authorized_keys</code>. <code>sshfs</code> should be installed with <code>sudo apt-get install sshfs</code>. Once installed you can mount your external server by editing <code>/etc/fstab</code> and adding:<pre>&lt;name>@192.168.1.11:/media/data/ /media/path/ fuse.sshfs _netdev,nonempty,allow_other,IdentityFile=/home/&lt;name>/.ssh/id_rsa,reconnect,ServerAliveInterval=45,ServerAliveCountMax=2 0 0
</pre><p>Make sure you set the relevant paths, IP addresses and usernames in the fstab entry above. Test it <a href="https://serverfault.com/questions/174181/how-do-you-validate-fstab-without-rebooting">without a reboot</a> by typing <code>sudo mount -a</code>.<p>With all that completed you are now set with the perfect slice of Pi. Time to get hacking on your projects!<h3>Optional Extras</h3><ul><li>Tweak <a href="https://www.bitpi.co/2015/02/11/how-to-change-raspberry-pis-swapfile-size-on-rasbian/%EF%BF%BD">your swap</a> if RAM is tight (works well with <a href="https://www.raspberrypi.org/products/compute-module-3/">compute modules</a>)<li><a href="http://blog.dustinkirkland.com/2011/02/long-overdue-introduction-ecryptfs.html">Encrypt your home folder</a><li><a href="http://longsteve.com/wiki/index.php?title=USB_Hard_Drive_Encryption_on_a_Raspberry_Pi">Encrypt an external drive</a><li><a href="https://wiki.ubuntu.com/MountWindowsSharesPermanently">Mount a samba/Windows share</a><li>Adjust the <a href="http://www.embeddedpi.com/documentation/installing-linux-os/cm3-speed-thermal-os-configuration-options%EF%BF%BD">thermal properties of the CPU</a></ul></div></div></article></main><div class="footer" role="contentinfo"><ul style="display:none"><li><a href="https://profiles.wordpress.org/scottsweb">WP</a><li><a href="https://twitter.com/scottsweb">Twitter</a><li><a href="https://github.com/scottsweb">GitHub</a><li><a href="https://api.scott.ee/feed/">RSS</a><li></ul><div class="no-ssr-placeholder"></div><div class="no-ssr-placeholder"></div></div></div></div></div><script type="text/javascript">window.__NUXT__={layout:"default",data:[{}],error:null,state:{pagination:{current:!1,totalPosts:0,pages:[],totalPostsPages:0,postsPerPage:10,paginate:!0},posts:[{id:1604,date:"2018-07-15T12:30:06",date_gmt:"2018-07-15T12:30:06",guid:{rendered:"https://api.scott.ee/?p=1604"},modified:"2018-07-15T12:30:06",modified_gmt:"2018-07-15T12:30:06",slug:"the-perfect-pi",status:"publish",type:"post",link:"https://api.scott.ee/journal/the-perfect-pi/",title:{rendered:"The Perfect Pi"},content:{rendered:'\n<p>In my next few posts I will be writing about my home automation setup which is based around a handful of Raspberry Pis. First though I want to document how I setup and get the most out of these fantastic little machines.</p>\n<p><noscript><img class="alignnone size-full wp-image-1635" src="https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?w=900&amp;ssl=1" alt="A Raspberry Pi Zero computer on a grey background" srcset="https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?w=1500&amp;ssl=1 1500w, https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?resize=250%2C140&amp;ssl=1 250w, https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?resize=768%2C429&amp;ssl=1 768w, https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?resize=700%2C391&amp;ssl=1 700w, https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?resize=120%2C67&amp;ssl=1 120w" sizes="(max-width: 900px) 100vw, 900px" data-recalc-dims="1"></noscript><div class="lazy"><img class="alignnone size-full wp-image-1635" src="" alt="A Raspberry Pi Zero computer on a grey background" srcset="" sizes="(max-width: 900px) 100vw, 900px" data-recalc-dims="1" data-src="https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?w=900&amp;ssl=1" data-srcset="https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?w=1500&amp;ssl=1 1500w, https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?resize=250%2C140&amp;ssl=1 250w, https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?resize=768%2C429&amp;ssl=1 768w, https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?resize=700%2C391&amp;ssl=1 700w, https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?resize=120%2C67&amp;ssl=1 120w"></div></p>\n<h3>Grab Raspbian Lite</h3>\n<p>Head over to <a href="https://www.raspberrypi.org/downloads/raspbian/">raspberrypi.org</a> and download the latest copy of Raspbian Lite. Every single Pi I have ever setup has been a headless machine so you don&rsquo;t need the bloat of the desktop environment. <a href="https://etcher.io/">Etcher</a> is a great tool for flashing the downloaded image to your SD card. Whilst you have the SD card in your computer, create a <a href="https://www.raspberrypi.org/documentation/remote-access/ssh/">blank file</a> called <code>ssh</code> in the <code>boot</code> directory to enable <code>ssh</code> and consider adding <a href="https://www.raspberrypi.org/documentation/configuration/wireless/headless.md">wireless network information</a> if your Pi will be using WiFi.</p>\n<h3>Set a Fixed IP</h3>\n<p>A fixed IP will make it easier to reliably <code>ssh</code> into the machine and browse to any services it may be running. I always set a static IP via my router. I find this a little quicker and simpler to do than on the Raspberry Pi itself and it makes the Pi more portable should I ever change my network, or take it elsewhere. Your router documentation should be able to guide you through the process.</p>\n<h3>Login and Update</h3>\n<pre>ssh pi@192.168.1.10</pre>\n<p>Once you have set your static IP you can login via terminal with the <code>pi</code> username and the default password of <code>raspberry</code>. You can then update the default software stack using:</p>\n<pre>sudo apt-get update\r\nsudo apt-get upgrade</pre>\n<h3>Raspi Config</h3>\n<p>This little utility will do a number of things. It will expand the file system, giving you access to the entire SD card, set a memorable hostname and lower the GPU memory to minimum (16mb). With the Pi running headless you shouldn&rsquo;t really need any graphics memory and this gives you the maximum amount of RAM for your projects and code. Run the utility with <code>raspi-config</code>, key around to change the above settings. Once that is done you will need to reboot and login again.</p>\n<p>After rebooting it is worth checking your time and timezone with <code>dpkg-reconfigure tzdata</code>. It has a similar interface to <code>raspi-config</code> and should be easy to find your way around with the keyboard.</p>\n<h3>Add a New User</h3>\n<p>It is a good idea to create your own user account and trash the original pi user. This will keep your Pi nice and safe should you expose it to the Internet or invite a hacker to stay in your house. Run the following commands in sequence replacing <code>&lt;name&gt;</code> with your chosen username.</p>\n<pre>sudo useradd -m &lt;name&gt; -G sudo\r\nsudo passwd &lt;name&gt;\r\nexit\r\nssh &lt;name&gt;@192.168.1.10\r\nsudo adduser &lt;name&gt; video\r\nsudo deluser -remove-home pi</pre>\n<p>These steps will:</p>\n<ul><li>Create you new user and add it to the <code>sudo</code> group</li>\n<li>Setup your password for your new user</li>\n<li>Logout</li>\n<li>Log back in again (remember to change the IP to that of your Pi)</li>\n<li>Add your new user to the video group which fixes a few Raspberry Pi tools like checking CPU temp</li>\n<li>Delete the original pi user and all files in the home directory (make sure you have backed up what you need there first)</li>\n</ul><p>If you find you are unable to autocomplete (tab) commands in your terminal with your new user it may be because you are using the wrong shell. You can fix this <a href="https://serverfault.com/a/99791">following the guide here</a>.</p>\n<h3>Install Git</h3>\n<pre>sudo apt-get install git-core</pre>\n<p>I try to store most of my project code on <a href="https://github.com/scottsweb">GitHub</a> if possible and the git-core package will make it possible to push and pull code from the command line. Whilst you are messing around with Git I recommend taking a look at the <a href="https://github.com/azlux/log2ram%EF%BF%BD">log2ram project</a>. It will store all of your system logs in RAM which is useful for reducing SD card wear and prolonging the life of the card. I don&rsquo;t use it on all my Pi projects but it can be useful on busy systems where you have some RAM to spare.</p>\n<h3>Speed Tweaks</h3>\n<p>As well as the usual <a href="https://www.raspberrypi.org/documentation/configuration/config-txt/overclocking.md">processor overclocking</a> that you <em>can</em> do (I haven&rsquo;t felt the need yet), you can also improve the performance of the SD card. To do so edit <code>boot/config.txt</code> and add <code>dtoverlay=sdhost,overclock_50=100</code> on a new line in the file. The overclock value will need to be adjusted to suit the SD card you are using. It is a fairly <a href="https://www.jeffgeerling.com/blog/2016/how-overclock-microsd-card-reader-on-raspberry-pi-3">involved process</a> to get the best value for your card but can make a real difference. <code>dmesg</code> is also useful for spotting issues. You should note that this change can cause issues with WiFi too if you are relying on that for your network connection.</p>\n<h3>Power Tweaks</h3>\n<p>One of my favourite things about Raspberry Pis is how power efficient they are. It means you can leave them all the time without worrying about the environmental impact or huge energy bills. With a few additional tweaks you can save a few more milliamps. There are some great tips come from&nbsp;Jeff Geerling in these <a href="http://www.jeffgeerling.com/blogs/jeff-geerling/raspberry-pi-zero-conserve-energy%EF%BF%BD">excellent</a> <a href="http://www.jeffgeerling.com/blogs/jeff-geerling/controlling-pwr-act-leds-raspberry-pi%EF%BF%BD">posts</a> that are worth running through. My favourite tweak is disabling the HDMI circuitry by adding <code>/usr/bin/tvservice -o</code> to <code>/etc/rc.local</code>.</p>\n<h3>Docker</h3>\n<p><a href="https://www.docker.com/">Docker</a> is a containerisation software that allows you to isolate software applications. Containers are more lightweight than traditional virtual machines. I find Docker the best way to run services on the Raspberry Pi, it allows me to get the most out of the resources available and removes the need to for reformat the SD card every time my tinkering goes a bit too far. Install docker with the following command and then add your user to the docker group:</p>\n<pre>curl -sSL https://get.docker.com | sh\r\nsudo usermod -aG docker &lt;name&gt;\r\n</pre>\n<p>Once again replace <code>&lt;name&gt;</code> with your chosen username. I recommend installing docker compose too. This will allow you to configure and start you containers reliably from <code class="highlighter-rouge">docker-compose.yml</code> config files.</p>\n<pre>sudo apt-get install python-pip\r\nsudo pip install docker-compose\r\n</pre>\n<p>This last Docker trick is optional. Docker can use quite a bit of space on your SD card so if you have external storage (like a hard drive) it can sometimes be beneficial to move <a href="http://stackoverflow.com/questions/24309526/how-to-change-the-docker-image-installation-directory">dockers internals to a different storage location</a>. Edit the docker.service file (<code>sudo nano /lib/systemd/system/docker.service</code>) and modify the line starting with <code>ExecStart</code> to be:</p>\n<pre>ExecStart=/usr/bin/dockerd -H fd:// -g /path/to/external/storage/\r\n</pre>\n<p>The path should be to your external storage. You can then restart Docker and check the change has saved by running:</p>\n<pre>sudo systemctl daemon-reload\r\nsudo systemctl restart docker\r\ndocker info | grep "loop file\\|Dir"\r\n</pre>\n<p>Updating Docker in future may require you to make this change again. You will know if it needs doing as your containers and images will disappear after an update.</p>\n<h3>SSH</h3>\n<p>Almost done. These next few steps will configure SSH, allow for a simpler login (SSH via public key) and mount an external server using <code>sshfs</code>. First generate some keys with <code>ssh-keygen -b 2048 -t rsa</code> and add public keys from your other computers to: <code>.ssh/authorized_keys</code>. <code>sshfs</code> should be installed with <code>sudo apt-get install sshfs</code>. Once installed you can mount your external server by editing <code>/etc/fstab</code> and adding:</p>\n<pre>&lt;name&gt;@192.168.1.11:/media/data/ /media/path/ fuse.sshfs _netdev,nonempty,allow_other,IdentityFile=/home/&lt;name&gt;/.ssh/id_rsa,reconnect,ServerAliveInterval=45,ServerAliveCountMax=2 0 0\r\n</pre>\n<p>Make sure you set the relevant paths, IP addresses and usernames in the fstab entry above. Test it <a href="https://serverfault.com/questions/174181/how-do-you-validate-fstab-without-rebooting">without a reboot</a> by typing <code>sudo mount -a</code>.</p>\n<p>With all that completed you are now set with the perfect slice of Pi. Time to get hacking on your projects!</p>\n<h3>Optional Extras</h3>\n<ul><li>Tweak <a href="https://www.bitpi.co/2015/02/11/how-to-change-raspberry-pis-swapfile-size-on-rasbian/%EF%BF%BD">your swap</a> if RAM is tight (works well with <a href="https://www.raspberrypi.org/products/compute-module-3/">compute modules</a>)</li>\n<li><a href="http://blog.dustinkirkland.com/2011/02/long-overdue-introduction-ecryptfs.html">Encrypt your home folder</a></li>\n<li><a href="http://longsteve.com/wiki/index.php?title=USB_Hard_Drive_Encryption_on_a_Raspberry_Pi">Encrypt an external drive</a></li>\n<li><a href="https://wiki.ubuntu.com/MountWindowsSharesPermanently">Mount a samba/Windows share</a></li>\n<li>Adjust the <a href="http://www.embeddedpi.com/documentation/installing-linux-os/cm3-speed-thermal-os-configuration-options%EF%BF%BD">thermal properties of the CPU</a></li>\n</ul>\n',protected:!1},excerpt:{rendered:'In my next few posts I will be writing about my home automation setup which is based around a handful of Raspberry Pis. First though I want to document how I setup and get the most out of these fantastic little machines. Grab Raspbian Lite Head over to raspberrypi.org and download the latest copy of</p><p><a class="view-article" href="https://api.scott.ee/journal/the-perfect-pi/">Read more</a></p>',protected:!1},author:1,featured_media:1635,comment_status:"closed",ping_status:"open",sticky:!1,template:"",format:"standard",meta:[],categories:[22,20],tags:[],_links:{self:[{href:"https://api.scott.ee/wp-json/wp/v2/posts/1604"}],collection:[{href:"https://api.scott.ee/wp-json/wp/v2/posts"}],about:[{href:"https://api.scott.ee/wp-json/wp/v2/types/post"}],author:[{embeddable:!0,href:"https://api.scott.ee/wp-json/wp/v2/users/1"}],replies:[{embeddable:!0,href:"https://api.scott.ee/wp-json/wp/v2/comments?post=1604"}],"version-history":[{href:"https://api.scott.ee/wp-json/wp/v2/posts/1604/revisions"}],"wp:featuredmedia":[{embeddable:!0,href:"https://api.scott.ee/wp-json/wp/v2/media/1635"}],"wp:attachment":[{href:"https://api.scott.ee/wp-json/wp/v2/media?parent=1604"}],"wp:term":[{taxonomy:"category",embeddable:!0,href:"https://api.scott.ee/wp-json/wp/v2/categories?post=1604"},{taxonomy:"post_tag",embeddable:!0,href:"https://api.scott.ee/wp-json/wp/v2/tags?post=1604"}],curies:[{name:"wp",href:"https://api.w.org/{rel}",templated:!0}]},_embedded:{author:[{id:1,name:"scottsweb",url:"",description:"",link:"https://api.scott.ee/journal/author/scottsweb/",slug:"scottsweb",_links:{self:[{href:"https://api.scott.ee/wp-json/wp/v2/users/1"}],collection:[{href:"https://api.scott.ee/wp-json/wp/v2/users"}]}}],"wp:featuredmedia":[{id:1635,date:"2018-07-15T12:17:39",slug:"journal-pi-zero",type:"attachment",link:"https://api.scott.ee/journal/the-perfect-pi/journal-pi-zero/",title:{rendered:"Raspberry Pi"},author:1,caption:{rendered:""},alt_text:"A Raspberry Pi Zero computer on a grey background",media_type:"image",mime_type:"image/jpeg",media_details:{width:1500,height:837,file:"journal-pi-zero.jpg",sizes:{thumbnail:{file:"journal-pi-zero-150x150.jpg",width:150,height:150,mime_type:"image/jpeg",source_url:"https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?resize=150%2C150&ssl=1"},medium:{file:"journal-pi-zero-250x140.jpg",width:250,height:140,mime_type:"image/jpeg",source_url:"https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?resize=250%2C140&ssl=1"},medium_large:{file:"journal-pi-zero-768x429.jpg",width:768,height:429,mime_type:"image/jpeg",source_url:"https://api.scott.ee/wp-content/uploads/journal-pi-zero-768x429.jpg"},large:{file:"journal-pi-zero-700x391.jpg",width:700,height:391,mime_type:"image/jpeg",source_url:"https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?resize=700%2C391&ssl=1"},small:{file:"journal-pi-zero-120x67.jpg",width:120,height:67,mime_type:"image/jpeg",source_url:"https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?resize=120%2C67&ssl=1"},avatar:{file:"journal-pi-zero-64x64.jpg",width:64,height:64,mime_type:"image/jpeg",source_url:"https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?resize=64%2C64&ssl=1"},full:{file:"journal-pi-zero.jpg?fit=1500%2C837&ssl=1",width:1500,height:837,mime_type:"image/jpeg",source_url:"https://i0.wp.com/api.scott.ee/wp-content/uploads/journal-pi-zero.jpg?fit=1500%2C837&ssl=1"}},image_meta:{aperture:"0",credit:"",camera:"",caption:"",created_timestamp:"0",copyright:"",focal_length:"0",iso:"0",shutter_speed:"0",title:"",orientation:"0",keywords:[]}},source_url:"https://api.scott.ee/wp-content/uploads/journal-pi-zero.jpg",_links:{self:[{href:"https://api.scott.ee/wp-json/wp/v2/media/1635"}],collection:[{href:"https://api.scott.ee/wp-json/wp/v2/media"}],about:[{href:"https://api.scott.ee/wp-json/wp/v2/types/attachment"}],author:[{embeddable:!0,href:"https://api.scott.ee/wp-json/wp/v2/users/1"}],replies:[{embeddable:!0,href:"https://api.scott.ee/wp-json/wp/v2/comments?post=1635"}]}}],"wp:term":[[{id:22,link:"https://api.scott.ee/journal/category/open-source/",name:"Open Source",slug:"open-source",taxonomy:"category",_links:{self:[{href:"https://api.scott.ee/wp-json/wp/v2/categories/22"}],collection:[{href:"https://api.scott.ee/wp-json/wp/v2/categories"}],about:[{href:"https://api.scott.ee/wp-json/wp/v2/taxonomies/category"}],"wp:post_type":[{href:"https://api.scott.ee/wp-json/wp/v2/posts?categories=22"}],curies:[{name:"wp",href:"https://api.w.org/{rel}",templated:!0}]}},{id:20,link:"https://api.scott.ee/journal/category/projects/",name:"Project",slug:"projects",taxonomy:"category",_links:{self:[{href:"https://api.scott.ee/wp-json/wp/v2/categories/20"}],collection:[{href:"https://api.scott.ee/wp-json/wp/v2/categories"}],about:[{href:"https://api.scott.ee/wp-json/wp/v2/taxonomies/category"}],"wp:post_type":[{href:"https://api.scott.ee/wp-json/wp/v2/posts?categories=20"}],curies:[{name:"wp",href:"https://api.w.org/{rel}",templated:!0}]}}],[]]},page:1}],pages:[]},serverRendered:!0}</script><script defer src="/_nuxt/manifest.db55fc87d9178386dc97.js"></script><script defer src="/_nuxt/layouts/default.5a3d1b942491c7b1e334.js"></script><script defer src="/_nuxt/pages/journal/_slug.cbe578972c01cc58c6be.js"></script><script defer src="/_nuxt/vendor.cceb4f39becbbe1be45e.js"></script><script defer src="/_nuxt/app.415c739b82f442bd5a40.js"></script>