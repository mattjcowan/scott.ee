[{"id":71,"date":"2009-03-07T17:42:23","date_gmt":"2009-03-07T17:42:23","guid":{"rendered":"http://scott.cloudcontrol.me/?p=71"},"modified":"2017-12-18T11:33:53","modified_gmt":"2017-12-18T11:33:53","slug":"using-mamp-as-a-local-development-server","status":"publish","type":"post","link":"https://api.scott.ee/journal/using-mamp-as-a-local-development-server/","title":{"rendered":"Using MAMP as a Local Development Server"},"content":{"rendered":"\n<p class=\"intro\">Having spent the last four hours knee deep in DNS, Apache and everywhere in-between I feel this information needs to be shared.</p>\n<p><noscript><img class=\"alignnone wp-image-1495 size-full\" src=\"https://i2.wp.com/scottsweb.mystagingwebsite.com/wp-content/uploads/2017/12/journal-mamp.jpg?resize=900%2C373&amp;ssl=1\" alt=\"MAMP application icon. The simple web server for OS X.\" width=\"900\" height=\"373\" srcset=\"https://i0.wp.com/api.scott.ee/wp-content/uploads/2017/12/journal-mamp.jpg?w=1500&amp;ssl=1 1500w, https://i0.wp.com/api.scott.ee/wp-content/uploads/2017/12/journal-mamp.jpg?resize=250%2C104&amp;ssl=1 250w, https://i0.wp.com/api.scott.ee/wp-content/uploads/2017/12/journal-mamp.jpg?resize=768%2C318&amp;ssl=1 768w, https://i0.wp.com/api.scott.ee/wp-content/uploads/2017/12/journal-mamp.jpg?resize=700%2C290&amp;ssl=1 700w, https://i0.wp.com/api.scott.ee/wp-content/uploads/2017/12/journal-mamp.jpg?resize=120%2C50&amp;ssl=1 120w\" sizes=\"(max-width: 900px) 100vw, 900px\" data-recalc-dims=\"1\"></noscript><div class=\"lazy\"><img class=\"alignnone wp-image-1495 size-full\" src=\"\" alt=\"MAMP application icon. The simple web server for OS X.\" width=\"900\" height=\"373\" srcset=\"\" sizes=\"(max-width: 900px) 100vw, 900px\" data-recalc-dims=\"1\" data-src=\"https://i2.wp.com/scottsweb.mystagingwebsite.com/wp-content/uploads/2017/12/journal-mamp.jpg?resize=900%2C373&amp;ssl=1\" data-srcset=\"https://i0.wp.com/api.scott.ee/wp-content/uploads/2017/12/journal-mamp.jpg?w=1500&amp;ssl=1 1500w, https://i0.wp.com/api.scott.ee/wp-content/uploads/2017/12/journal-mamp.jpg?resize=250%2C104&amp;ssl=1 250w, https://i0.wp.com/api.scott.ee/wp-content/uploads/2017/12/journal-mamp.jpg?resize=768%2C318&amp;ssl=1 768w, https://i0.wp.com/api.scott.ee/wp-content/uploads/2017/12/journal-mamp.jpg?resize=700%2C290&amp;ssl=1 700w, https://i0.wp.com/api.scott.ee/wp-content/uploads/2017/12/journal-mamp.jpg?resize=120%2C50&amp;ssl=1 120w\"></div></p>\n<p>I will start off by explaining my requirements. I am thinking of buying a <a title=\"mmmm Mac Pro\" href=\"http://www.apple.com/macpro/\">Mac Pro</a> to use as my main machine and to replace the Linux server we currently have setup in the corner of the office. If the Mac Pro is going to replace the Linux box it needs to provide us with a web server (as well as file sharing, media sharing etc) and the web server needs to be accessible over the local network to all other machines in the office. Our Linux box is serving us well but I see an opportunity to merge two computers into one; making for a greener office and hopefully it will be a little easier to manage (I am far more comfortable in OS X than <a title=\"ClarkConnect - Linux Distro\" href=\"http://www.clarkconnect.com/\">ClarkConnect</a>). We call our Linux machine &ldquo;tux&rdquo;, it has its own DNS server that means we can access it over the network at tux.lan. It works well but one of my issues with it has been having to install websites into sub-directories. For example our local <a title=\"toggle - handmade gadget cases\" href=\"http://www.toggle.uk.com\">toggle</a> website sits at tux.lan/toggle.uk.com. Because our local sites do not live in a root web folder our local sites can have a number of differences compared to the live sites, these differences mean we have to be careful when deploying changes.</p>\n<p>I have spent today looking at ways I can use the standard install of OS X to act as a web server. Although OS X comes with Apache built in, one of the simplest ways to get PHP, MySQL and Apache is to use <a title=\"Mac, Apache, PHP, MySQL\" href=\"http://www.mamp.info/\">MAMP</a>. I have been using MAMP for a number of years and love the fact it is expendable and not deeply integrated into the system. If I want to change PHP version I can do so at the touch of a button and if it goes wrong I can copy a new version over the top. So how do we share MAMP over the local network with nice (virtual hostey) URLs like: toggle.uk.com.dev?</p>\n<h3>You Will Need:</h3>\n<p>I am going to assume you have a few things in place:</p>\n<ol><li>You are running OS X 10.5+</li>\n<li>Your Mac has a fixed IP address on your local network (e.g. 192.168.0.10)</li>\n<li>You have installed MAMP and your document root is your OS X sites folder</li>\n<li>You can use Terminal</li>\n</ol><p>The next couple of steps were modified from <a title=\"A smarter MAMP\" href=\"http://postpostmodern.com/instructional/a-smarter-mamp/\">postpostmodern.com</a>, which is the closest tutorial I could find to what I was trying to achieve. The main difference here is that we want this to work across the local network and not just on the one local machine.</p>\n<h3>BIND &ndash; The Hidden OS X DNS Server</h3>\n<p>A DNS server converts a name (<a title=\"Google\" href=\"http://www.google.com\">google.com</a>) to an IP address (<a title=\"Google's IP\" href=\"http://74.125.45.100/\">74.125.45.100</a>) &ndash; it basically means we do not have to remember IP addresses for the sites we want to visit. We need to enable the DNS server on our OSX machine so when we enter a local URL (toggle.uk.com.dev) it looks for the website on the local server (which lives at 192.168.0.10). I am not a DNS expert but following these steps did the trick for me.</p>\n<h4>Setup rndc</h4>\n<p>Open up terminal and get into root:<code> sudo -s</code><br>\nGenerate the config file for &lsquo;rndc&rsquo;:<code> rndc-confgen &gt; /etc/rndc.conf<br></code>Copy a key to the newly created file:<code> head -n 6 /etc/rndc.conf &gt; /etc/rndc.key</code></p>\n<h4>Create your DNS Zone File</h4>\n<p>DNS zones are created via files in /var/named. Create a new file in there called dev.zone and fill it with this:</p>\n<pre><code>;\r\n; BIND data file for dev sites\r\n;\r\n$TTL 604800\r\n@ IN SOA dev. root.dev. (\r\n2008101920 ; Serial\r\n604800 ; Refresh\r\n86400 ; Retry\r\n2419200 ; Expire\r\n604800 ) ; Negative Cache TTL\r\n;\r\n@ IN NS dev.\r\n@ IN A 192.168.0.10\r\n*.dev. 14400 IN A 192.168.0.10\r\n</code></pre>\n<p>You will have to replace the IP address (192.168.0.10) with the IP address of your Mac on the local network, remember this should be a fixed IP to ensure it keeps working.</p>\n<h4>Configure named.conf</h4>\n<p>Open /etc/named.conf. The first thing you want to do here is to show named where to get its DNS info (for the rest of the internet), it is probably best to use the <a title=\"Super Duper DNS\" href=\"http://www.opendns.com/\">OpenDNS</a> servers. Scroll through this file until you see an options section with the line: directory &ldquo;/var/named&rdquo;; &ndash; just after this paste the following code:</p>\n<pre><code>forwarders {\r\n    208.67.222.222;\r\n    208.67.220.220;\r\n};\r\n</code></pre>\n<p>Next we need to add a reference to the zone file we created a minute ago. There is a localhost section already in /etc/named.conf, find it and post the following code below it:</p>\n<pre><code>zone \"dev\" IN {\r\n    type master;\r\n    file \"dev.zone\";\r\n};\r\n</code></pre>\n<h4>Getting DNS to start with your Mac</h4>\n<p>Open the LaunchDaemon plist file (/System/Library/LaunchDaemons/org.isc.named.plist) and look for the first instance of the word &lsquo;true&rsquo; and change it to &lsquo;false&rsquo;. It should appear just under the word &lsquo;disabled&rsquo;. You can now load it using the following terminal command:</p>\n<pre><code>sudo launchctl load /System/Library/LaunchDaemons/org.isc.named.plist</code></pre>\n<p>The DNS server should now be up and running on your machine, you will need to tell other machines on your network and the Mac itself to look at this IP address for DNS. In system preferences -&gt; network -&gt; add &lsquo;127.0.0.1&rsquo; to the list of DNS servers (for the server itself) and for other machines on the network add &lsquo;192.168.0.10&rsquo; to the list of DNS servers. The other machines on the network will now look to this IP address when you first type in a URL into your browser.</p>\n<h3>Setup MAMP</h3>\n<p>Now that the DNS stuff is out of the way, it&rsquo;s just a matter of setting that magic directive in your Apache conf file. The directive is called <a href=\"http://httpd.apache.org/docs/2.2/mod/mod_vhost_alias.html\">VirtualDocumentRoot</a>. You need to navigate to the MAMP folder (/Applications/MAMP/conf/apache) and open up httpd.conf in a text editor of your choice. Search the file for &ldquo;Virtual hosts&rdquo; and uncomment the line just below:</p>\n<pre><code>Include /Applications/MAMP/conf/apache/extra/httpd-vhosts.conf</code></pre>\n<p>Next open the httpd-vhost.conf file in the extra folder, scroll to the very bottom of the file and add the following code:</p>\n<pre><code>NameVirtualHost 192.168.0.10\r\n\r\n&lt;VirtualHost 192.168.0.10&gt;\r\n    VirtualDocumentRoot /Users/YOURUSERNAME/Sites/%-2+/\r\n&lt;/VirtualHost&gt;\r\n</code></pre>\n<p>The VirtualDocumentRoot is an interpolated path for finding your sites. &lsquo;%-2+&rsquo; means everything before the .dev. So: example.dev would load files from /Users/YOURUSERNAME/Sites/example/. If MAMP was running you should now re-start Apache and visiting example.dev in your browser should bring up a 404 (unless of course you have a folder called example in your sites folder). Did it work?</p>\n<h3>Hitting Problems</h3>\n<p>I had a number of issues getting this to work across the network and during that time I was running quite a few commands to get rndc to restart without having to reboot my machine every time I made a change. At first I could not get rndc to listen to any of my commands, searching Google once more I found a handy <a title=\"DNS Problem - rndc: connect failed: connection refused \" href=\"http://www.daniweb.com/forums/post226617-12.html\">forum tip</a> suggesting the issue might be related to port numbers. I suggest you follow these few extra steps to resolve the issue:</p>\n<p>Open up terminal and run the following: <code>sudo nano /etc/rndc.conf</code> &ndash; look for the options at the top of the file and make sure the default port is set to 54. Save (ctrl-x, Y, Enter) and you should now be able to use the the command line to interface with rndc.</p>\n<h3>Useful Commands</h3>\n<p>Whilst working through the steps above I came across a number of handy command line tools that you might find useful too:</p>\n<p><code>nslookup dev</code> : nslookup will interactively find MX and other records. I used this on network machines to see if they correctly identified the Mac as the .dev server. <code>dscacheutil -flushcache</code> : OSX has a tendency to cache DNS, this flushes the cache so you can check your changes. <code>rndc reload</code> : This reloaded any changes I made to my DNS zone files.</p>\n<p>So that brings me to the end of this tutorial, having successfully tested this on my Mac laptop I am now one step closer to making a decision about the Mac Pro. How did you get on?</p>\n<p>p.s. If you follow these steps and consequently have issues with PHP&rsquo;s <code>$_SERVER['DOCUMENT_ROOT']</code> variable. You might wish to follow the advice <a href=\"https://issues.apache.org/bugzilla/show_bug.cgi?id=26052#c27\" rel=\"external nofollow\">here</a>. Apache does not play well with document roots and virtual hosts.</p>\n","protected":false},"excerpt":{"rendered":"Use MAMP as a local development server for your home or office network with clean .dev URLs for your local sites.","protected":false},"author":1,"featured_media":0,"comment_status":"closed","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":[],"categories":[11],"tags":[],"_links":{"self":[{"href":"https://api.scott.ee/wp-json/wp/v2/posts/71"}],"collection":[{"href":"https://api.scott.ee/wp-json/wp/v2/posts"}],"about":[{"href":"https://api.scott.ee/wp-json/wp/v2/types/post"}],"author":[{"embeddable":true,"href":"https://api.scott.ee/wp-json/wp/v2/users/1"}],"replies":[{"embeddable":true,"href":"https://api.scott.ee/wp-json/wp/v2/comments?post=71"}],"version-history":[{"href":"https://api.scott.ee/wp-json/wp/v2/posts/71/revisions"}],"wp:attachment":[{"href":"https://api.scott.ee/wp-json/wp/v2/media?parent=71"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https://api.scott.ee/wp-json/wp/v2/categories?post=71"},{"taxonomy":"post_tag","embeddable":true,"href":"https://api.scott.ee/wp-json/wp/v2/tags?post=71"}],"curies":[{"name":"wp","href":"https://api.w.org/{rel}","templated":true}]},"_embedded":{"author":[{"id":1,"name":"scottsweb","url":"","description":"","link":"https://api.scott.ee/journal/author/scottsweb/","slug":"scottsweb","_links":{"self":[{"href":"https://api.scott.ee/wp-json/wp/v2/users/1"}],"collection":[{"href":"https://api.scott.ee/wp-json/wp/v2/users"}]}}],"wp:term":[[{"id":11,"link":"https://api.scott.ee/journal/category/wordpress/","name":"WordPress","slug":"wordpress","taxonomy":"category","_links":{"self":[{"href":"https://api.scott.ee/wp-json/wp/v2/categories/11"}],"collection":[{"href":"https://api.scott.ee/wp-json/wp/v2/categories"}],"about":[{"href":"https://api.scott.ee/wp-json/wp/v2/taxonomies/category"}],"wp:post_type":[{"href":"https://api.scott.ee/wp-json/wp/v2/posts?categories=11"}],"curies":[{"name":"wp","href":"https://api.w.org/{rel}","templated":true}]}}],[]]},"page":5}]